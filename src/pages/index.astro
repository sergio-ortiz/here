---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout>
	<div class="window" style="width: 300px; margin: auto">
		<div class="title-bar">
			<div class="title-bar-text">Check in program</div>
			<div class="title-bar-controls">
				<button aria-label="Minimize"></button>
				<button aria-label="Maximize"></button>
				<button aria-label="Close"></button>
			</div>
		</div>
		<div class="window-body">
			<p id="message" aria-busy="true">Checking in...</p>
		</div>
	</div>

	<form id="myForm" hx-post="/partials/checkin" hx-target="#message" hx-swap="outerHTML">
		<input type ="hidden" name="latitude" />
		<input type="hidden" name="longitude" />
		<input type="hidden" name="timestamp" />
	</form>
	
	<script>
		function success({ coords: { latitude, longitude }, timestamp }) {
			const latitudeInput = document.querySelector('input[name=latitude]');
			const longitudeInput = document.querySelector('input[name=longitude]');
			const timestampInput = document.querySelector('input[name=timestamp]');

			latitudeInput.value = latitude;
			longitudeInput.value = longitude;
			timestampInput.value = timestamp;

			htmx.trigger("#myForm", "submit");
		}

		navigator.geolocation.getCurrentPosition(success);
	</script>
	<style>
		body {
			background: teal;
		}
	</style>
</BaseLayout>
